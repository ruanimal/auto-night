# Auto Night
Kwin 脚本，根据是否有全屏应用，自动切换 nightlight 状态

## 打包
zip -r auto-night.kwinscript auto-night -x "auto-night/.git/*"

## 安装
设置 -> 窗口管理 -> kwin 脚本 -> 从文件安装

安装后脚本目录结构
```
/home/<username>/.local/share/kwin/scripts
├── auto-night
│   ├── contents
│   │   └── code
│   │       └── main.js
│   ├── metadata.json
│   └── README
└── kwin.js
```

## 调试
js 脚本是基于监听事件模式运行的，运行脚本时无法获得返回值
可以 journalctl 查看标准输出和错误输出
如果没有注册事件，则脚本就只是单次执行，再次运行得重新加载

- 查看日志：`journalctl --user-unit=plasma-kwin_wayland -f -n100 |grep kwin_wayland `
- 加载脚本：`qdbus6 org.kde.KWin /Scripting loadScript <脚本绝对路径>`, 输出为脚本id
- 运行脚本：`qdbus6 org.kde.KWin /Scripting/Script<脚本id> run`
- 卸载脚本：`qdbus6 org.kde.KWin /Scripting unloadScript <脚本绝对路径>`
- 交互式调试：`plasma-interactiveconsole --kwin `，可以直接执行 js 代码，输出还是在 journalctl

## 参考
### 文档
- https://develop.kde.org/docs/plasma/kwin/
- https://develop.kde.org/docs/plasma/kwin/api/

### 命令行控制 nightlight
切换状态
- qdbus6 org.kde.kglobalaccel /component/kwin invokeShortcut "Toggle Night Color"

获取状态
- qdbus6 org.kde.KWin /org/kde/KWin/NightLight org.kde.KWin.NightLight.running
- qdbus6 org.kde.KWin /org/kde/KWin/NightLight org.freedesktop.DBus.Properties.Get org.kde.KWin.NightLight running
